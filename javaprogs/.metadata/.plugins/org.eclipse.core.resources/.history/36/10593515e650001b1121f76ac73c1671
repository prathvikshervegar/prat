package see;

import java.io.*;
import java.net.*;
import java.util.*;

public class TCPserver {
	private static ServerSocket servSock;
	 private static int PORT = 1234;
	 public static void main(String[] args) {
	 System.out.println("Connecting to port..\n");
	 try {
	 servSock = new ServerSocket(PORT);
	 } catch (IOException e) {
	 e.printStackTrace();
	 System.exit(1);
	 }
	 do {
	 handleClient();
	 }while (true);
	 }
	 public static void handleClient(){
	 Socket link = null;
	 try {
	 link = servSock.accept();
	 PrintWriter pw = new PrintWriter(link.getOutputStream());
	 Scanner s = new Scanner(link.getInputStream());
	 int num = 0;
	 String message;
	 message = s.nextLine();
	 while (!message.equals("close")){
	 num++;
	 System.out.println("Received");
	 pw.println("Message "+num+": "+message);
	 message = s.nextLine();
	 }
	 pw.println(num+" messages received");
	 } catch (IOException e) {
	 e.printStackTrace();
	 }
	 finally {
	 try {
	 link.close();
	 System.exit(1);
	 } catch (IOException e) {
	 e.printStackTrace();
	 System.exit(1);
	 }
	 }
	 }
}